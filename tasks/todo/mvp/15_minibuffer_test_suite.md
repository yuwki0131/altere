# ミニバッファ テストスイート実装

## タスク概要
`docs/design/minibuffer_tests.md` を基に、ミニバッファのコア機能・補完・履歴・エラーメッセージをカバーする包括的なテストスイートを構築する。

## 目的
- ミニバッファの入力・履歴・補完機能の信頼性を保証
- ファイル操作コマンドとエラー表示の回帰を防止
- Unicode入力やセッション内履歴など多様なケースを自動化
- ミニバッファ設計仕様との整合性を検証

## 実装対象
1. **単体テスト**
   - 文字入力／カーソル移動／削除の動作確認
   - C-g でのキャンセル処理と状態リセット
   - Unicode文字・制御キー入力の取り扱い
2. **履歴機能テスト**
   - 履歴追加・ナビゲーション（Ctrl+P / Ctrl+N）
   - find-file / execute-command 切り替え時の履歴選択
   - 履歴上限・重複処理の検証
3. **補完システムテスト**
   - TAB 補完の候補生成・共通接頭辞の適用
   - ファイルシステムベースの補完（TempDir を利用）
   - 候補選択ナビゲーション（上下キー）
4. **ファイル操作コマンド統合テスト**
   - `C-x C-f` / `C-x C-s` / `C-x C-c` 実行フロー
   - エラー発生時のメッセージ表示とタイムアウト
   - 新規ファイル／既存ファイル読み込みの挙動
5. **エラーハンドリング検証**
   - 権限不足・無効パス・読み込み失敗時のメッセージ
   - 5秒間のメッセージ表示と自動クリア
   - Logger/ErrorDisplay との連携確認

## 成果物
- `tests/minibuffer/` 配下のテストモジュール（単体・統合）
- テスト用ヘルパー（モック入力、TempDir ラッパー等）
- CI/ローカル手順メモ（テストの実行方法）
- 不具合再発防止のための既知問題チェックリスト

## 前提条件
- 10_minibuffer_system_implementation.md が完了していること
- 07_file_operations_implementation.md（本タスクと並行または完了）
- エラーハンドリング実装（02）の利用

## 完了条件
- [ ] 入力処理とカーソル操作の単体テスト完了
- [ ] 履歴機能テスト（追加・遷移）の実装
- [ ] 補完システムのファイルベース統合テスト
- [ ] ファイル操作コマンド（find-file / save-buffer / quit）の統合テスト
- [ ] エラーメッセージ表示とタイムアウト処理の検証
- [ ] 主要ケースで `cargo test minibuffer` が安定して成功

## 見積もり
**期間**: 2日
**優先度**: 中（品質保証）

## 関連タスク
- 07_file_operations_implementation.md（ファイル操作連携）
- 09_basic_editing_core_implementation.md（バッファ更新）
- 12_performance_optimization_implementation.md（補完性能検証への入力）

## 技術的考慮事項
- TempDir / テストファイル作成時のクリーンアップ
- 非同期イベントを伴わない TUI 環境でのシミュレート入力
- エラー表示時間確認のためのタイマーモック化
- Unicode / パス長など境界ケースのカバレッジ
